<?xml version="1.0" encoding="UTF-8"?>
<svg width="900" height="700" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" 
            refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333" />
    </marker>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-color="#000" flood-opacity="0.3"/>
    </filter>
  </defs>
  
  <!-- Background -->
  <rect width="900" height="700" fill="#f8f9fa"/>
  
  <!-- Title -->
  <text x="450" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#2c3e50">
    LangGraph Adaptive RAG Workflow
  </text>
  
  <!-- START -->
  <ellipse cx="450" cy="80" rx="40" ry="25" fill="#2ecc71" filter="url(#shadow)"/>
  <text x="450" y="85" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">
    START
  </text>
  
  <!-- Route Question -->
  <rect x="380" y="140" width="140" height="60" rx="10" fill="#3498db" filter="url(#shadow)"/>
  <text x="450" y="165" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">
    route_question
  </text>
  <text x="450" y="180" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">
    (GPT-4o-mini)
  </text>
  <text x="450" y="195" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">
    → vectorstore | web_search
  </text>
  
  <!-- Web Search Branch -->
  <rect x="100" y="280" width="120" height="60" rx="10" fill="#e74c3c" filter="url(#shadow)"/>
  <text x="160" y="305" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">
    web_search
  </text>
  <text x="160" y="320" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">
    (Tavily API)
  </text>
  
  <!-- Vectorstore Branch -->
  <rect x="680" y="280" width="120" height="60" rx="10" fill="#9b59b6" filter="url(#shadow)"/>
  <text x="740" y="305" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">
    retrieve
  </text>
  <text x="740" y="320" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">
    (Chroma)
  </text>
  
  <!-- Grade Documents -->
  <rect x="680" y="380" width="120" height="60" rx="10" fill="#f39c12" filter="url(#shadow)"/>
  <text x="740" y="400" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">
    grade_documents
  </text>
  <text x="740" y="415" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">
    Relevance check
  </text>
  <text x="740" y="430" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">
    Filter docs
  </text>
  
  <!-- Transform Query -->
  <rect x="550" y="480" width="120" height="60" rx="10" fill="#16a085" filter="url(#shadow)"/>
  <text x="610" y="500" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">
    transform_query
  </text>
  <text x="610" y="515" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">
    Question
  </text>
  <text x="610" y="530" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">
    rewriting
  </text>
  
  <!-- Generate (Main) -->
  <rect x="390" y="380" width="120" height="60" rx="10" fill="#8e44ad" filter="url(#shadow)"/>
  <text x="450" y="405" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">
    generate
  </text>
  <text x="450" y="420" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">
    RAG Chain
  </text>
  <text x="450" y="435" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">
    (GPT-4o-mini)
  </text>
  
  <!-- Quality Grading -->
  <rect x="220" y="500" width="140" height="80" rx="10" fill="#d35400" filter="url(#shadow)"/>
  <text x="290" y="520" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">
    grade_generation
  </text>
  <text x="290" y="535" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">
    1. Check hallucinations
  </text>
  <text x="290" y="550" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">
    2. Grade answer quality
  </text>
  <text x="290" y="565" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">
    → useful | not useful
  </text>
  
  <!-- END -->
  <ellipse cx="450" cy="650" rx="40" ry="25" fill="#27ae60" filter="url(#shadow)"/>
  <text x="450" y="655" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">
    END
  </text>
  
  <!-- Quality Verification Components -->
  <rect x="50" y="50" width="200" height="90" rx="5" fill="#ecf0f1" stroke="#bdc3c7" stroke-width="2"/>
  <text x="150" y="70" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#2c3e50">
    Quality Verification System
  </text>
  <text x="150" y="90" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#2c3e50">
    • GradeDocuments (Relevance)
  </text>
  <text x="150" y="105" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#2c3e50">
    • GradeHallucinations (Grounding)
  </text>
  <text x="150" y="120" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#2c3e50">
    • GradeAnswer (Quality)
  </text>
  
  <!-- State Management -->
  <rect x="650" y="50" width="200" height="90" rx="5" fill="#ecf0f1" stroke="#bdc3c7" stroke-width="2"/>
  <text x="750" y="70" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#2c3e50">
    GraphState Management
  </text>
  <text x="750" y="90" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#2c3e50">
    • question: str
  </text>
  <text x="750" y="105" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#2c3e50">
    • generation: str
  </text>
  <text x="750" y="120" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#2c3e50">
    • documents: List[str]
  </text>
  
  <!-- Arrows -->
  <!-- START to route_question -->
  <line x1="450" y1="105" x2="450" y2="140" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- route_question to branches -->
  <line x1="390" y1="180" x2="220" y2="280" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="510" y1="180" x2="680" y2="280" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- web_search to generate -->
  <line x1="220" y1="310" x2="390" y2="380" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- retrieve to grade_documents -->
  <line x1="740" y1="340" x2="740" y2="380" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- grade_documents to generate -->
  <line x1="680" y1="410" x2="510" y2="410" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- grade_documents to transform_query -->
  <line x1="680" y1="430" x2="670" y2="500" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- transform_query back to retrieve -->
  <line x1="610" y1="480" x2="740" y2="340" stroke="#333" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead)"/>
  
  <!-- generate to grade_generation -->
  <line x1="420" y1="440" x2="320" y2="500" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- grade_generation to END -->
  <line x1="350" y1="540" x2="420" y2="630" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- grade_generation back to transform_query -->
  <line x1="360" y1="540" x2="550" y2="510" stroke="#333" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead)"/>
  
  <!-- grade_generation back to generate -->
  <line x1="290" y1="500" x2="420" y2="440" stroke="#333" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead)"/>
  
  <!-- Labels -->
  <text x="300" y="230" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#666">
    web_search
  </text>
  <text x="600" y="230" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#666">
    vectorstore
  </text>
  
  <text x="720" y="465" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">
    no relevant docs
  </text>
  <text x="720" y="365" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">
    has relevant docs
  </text>
  
  <text x="380" y="590" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">
    useful
  </text>
  <text x="470" y="480" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">
    not useful
  </text>
  <text x="200" y="460" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">
    not supported
  </text>
  
  <!-- Loop indicator -->
  <text x="650" y="450" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e74c3c" font-style="italic">
    retry loop
  </text>
</svg>